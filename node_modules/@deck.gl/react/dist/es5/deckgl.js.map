{"version":3,"sources":["../../src/deckgl.js"],"names":["propTypes","Deck","getPropTypes","PropTypes","defaultProps","DeckGL","props","state","width","height","viewState","initialViewState","children","DeckClass","deck","Object","assign","canvas","deckCanvas","_getViewState","onViewStateChange","_onViewStateChange","onResize","_onResize","finalize","x","y","radius","layerIds","pickObject","depth","pickMultipleObjects","pickObjects","opts","log","removed","params","setState","viewId","nextProps","viewports","viewport","layers","views","deckProps","setProps","latitude","longitude","zoom","pitch","bearing","viewManager","length","defaultViewId","id","map","child","i","viewportId","viewChildren","type","View","getViewport","getViewState","style","position","left","top","key","_updateFromProps","_positionChildrenUnderViews","ref","c","push","React","PureComponent"],"mappings":"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","sourcesContent":["// Copyright (c) 2015 - 2017 Uber Technologies, Inc.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a copy\n// of this software and associated documentation files (the \"Software\"), to deal\n// in the Software without restriction, including without limitation the rights\n// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n// copies of the Software, and to permit persons to whom the Software is\n// furnished to do so, subject to the following conditions:\n//\n// The above copyright notice and this permission notice shall be included in\n// all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n// THE SOFTWARE.\n\nimport React, {createElement} from 'react';\nimport PropTypes from 'prop-types';\nimport {Deck, View, log} from '@deck.gl/core';\nimport extractJSXLayers from './utils/extract-jsx-layers';\nimport {inheritsFrom} from './utils/inherits-from';\nimport evaluateChildren from './utils/evaluate-children';\nimport autobind from './utils/autobind';\n\nconst propTypes = Deck.getPropTypes(PropTypes);\n\nconst defaultProps = Deck.defaultProps;\n\nexport default class DeckGL extends React.PureComponent {\n  constructor(props) {\n    super(props);\n    this.state = {\n      width: 0,\n      height: 0,\n      viewState: props.initialViewState\n    };\n    this.children = [];\n    autobind(this);\n  }\n\n  componentDidMount() {\n    // Allows a subclass of Deck to be used\n    // TODO - update propTypes / defaultProps?\n    const DeckClass = this.props.Deck || Deck;\n\n    // DEVTOOLS can cause this to be called twice\n    this.deck =\n      this.deck ||\n      new DeckClass(\n        Object.assign({}, this.props, {\n          initialViewState: null,\n          canvas: this.deckCanvas,\n          viewState: this._getViewState(this.props),\n          // Note: If Deck event handling change size or view state, it calls onResize to update\n          onViewStateChange: this._onViewStateChange,\n          onResize: this._onResize\n        })\n      );\n  }\n\n  componentWillUnmount() {\n    this.deck.finalize();\n  }\n\n  // Public API\n\n  pickObject({x, y, radius = 0, layerIds = null}) {\n    return this.deck.pickObject({x, y, radius, layerIds});\n  }\n\n  pickMultipleObjects({x, y, radius = 0, layerIds = null, depth = 10}) {\n    return this.deck.pickMultipleObjects({x, y, radius, layerIds, depth});\n  }\n\n  pickObjects({x, y, width = 1, height = 1, layerIds = null}) {\n    return this.deck.pickObjects({x, y, width, height, layerIds});\n  }\n\n  queryObject(opts) {\n    log.removed('queryObject', 'pickObject')();\n  }\n\n  queryVisibleObjects(opts) {\n    log.removed('queryVisibleObjects', 'pickObjects')();\n  }\n\n  // Callbacks\n\n  // Forward callback and then call forceUpdate to guarantee that sub components update\n  _onResize(params) {\n    this.setState(params);\n    this.props.onResize(params);\n  }\n\n  // Forward callback and then call forceUpdate to guarantee that sub components update\n  _onViewStateChange(params) {\n    // Let app know that view state is changing, and give it a chance to change it\n    const viewState = this.props.onViewStateChange(params) || params.viewState;\n\n    // If initialViewState was set on creation, auto track position\n    if (this.state.viewState) {\n      this.setState({\n        viewState: Object.assign({}, this.state.viewState, {\n          [params.viewId]: viewState\n        })\n      });\n    }\n  }\n\n  // Private Helpers\n\n  // 1. Extract any JSX layers from the react children\n  // 2. Handle any backwards compatiblity props for React layer\n  // Needs to be called both from initial mount, and when new props arrive\n  _updateFromProps(nextProps) {\n    if (!this.deck) {\n      return;\n    }\n\n    if (nextProps.viewports || nextProps.viewport) {\n      log.removed('DeckGL.viewport(s)', 'DeckGL.views')();\n    }\n\n    // extract any deck.gl layers masquerading as react elements from props.children\n    const {layers, views, children} = extractJSXLayers(nextProps);\n\n    const deckProps = Object.assign({}, nextProps, {\n      onViewStateChange: this._onViewStateChange,\n      onResize: this._onResize,\n      layers,\n      views\n    });\n\n    const viewState = this._getViewState(nextProps);\n    if (viewState) {\n      deckProps.viewState = viewState;\n    }\n\n    this.deck.setProps(deckProps);\n\n    this.children = children;\n  }\n\n  // Supports old \"geospatial view state as separate props\" style (React only!)\n  _getViewState(props) {\n    if (!props.viewState && 'latitude' in props && 'longitude' in props && 'zoom' in props) {\n      if ('maxZoom' in props || 'minZoom' in props) {\n        log.removed('maxZoom/minZoom', 'viewState');\n      }\n      const {latitude, longitude, zoom, pitch = 0, bearing = 0} = props;\n      return {latitude, longitude, zoom, pitch, bearing};\n    }\n    return props.viewState || this.state.viewState;\n  }\n\n  // Iterate over views and reposition children associated with views\n  // TODO - Can we supply a similar function for the non-React case?\n  _positionChildrenUnderViews(children) {\n    const {viewManager} = this.deck || {};\n\n    if (!viewManager || !viewManager.views.length) {\n      return [];\n    }\n\n    const defaultViewId = viewManager.views[0].id;\n\n    return children.map((child, i) => {\n      if (child.props.viewportId) {\n        log.removed('viewportId', '<View>')();\n      }\n      if (child.props.viewId) {\n        log.removed('viewId', '<View>')();\n      }\n\n      // Unless child is a View, position / render as part of the default view\n      let viewId = defaultViewId;\n      let viewChildren = child;\n      if (inheritsFrom(child.type, View)) {\n        viewId = child.props.id || defaultViewId;\n        viewChildren = child.props.children;\n      }\n\n      const viewport = viewManager.getViewport(viewId);\n      const viewState = viewManager.getViewState(viewId);\n\n      // Drop (auto-hide) elements with viewId that are not matched by any current view\n      if (!viewport) {\n        return null;\n      }\n\n      // Resolve potentially relative dimensions using the deck.gl container size\n      const {x, y, width, height} = viewport;\n\n      viewChildren = evaluateChildren(viewChildren, {\n        x,\n        y,\n        width,\n        height,\n        viewport,\n        viewState\n      });\n\n      const style = {position: 'absolute', left: x, top: y, width, height};\n      const key = `view-child-${viewId}-${i}`;\n      return createElement('div', {key, id: key, style}, viewChildren);\n    });\n  }\n\n  render() {\n    // TODO - expensive to update on every render?\n    this._updateFromProps(this.props);\n\n    // Render the background elements (typically react-map-gl instances)\n    // using the view descriptors\n    const children = this._positionChildrenUnderViews(this.children);\n\n    // TODO - this styling is enforced for correct positioning with children\n    // It can override the styling set by `Deck`, this should be consolidated.\n    // Note that width and height are handled by deck.gl\n    const style = Object.assign({}, {position: 'absolute', left: 0, top: 0}, this.props.style);\n\n    const canvas = createElement('canvas', {\n      ref: c => (this.deckCanvas = c),\n      key: 'deck-canvas',\n      id: this.props.id,\n      style\n    });\n\n    // Render deck.gl as last child\n    children.push(canvas);\n\n    return createElement('div', {id: 'deckgl-wrapper'}, children);\n  }\n}\n\nDeckGL.propTypes = propTypes;\nDeckGL.defaultProps = defaultProps;\n"],"file":"deckgl.js"}