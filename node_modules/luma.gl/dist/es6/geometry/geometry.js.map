{"version":3,"sources":["../../../src/geometry/geometry.js"],"names":["uid","assert","DRAW_MODE","POINTS","LINES","LINE_LOOP","LINE_STRIP","TRIANGLES","TRIANGLE_STRIP","TRIANGLE_FAN","getDrawMode","drawMode","mode","Geometry","constructor","opts","id","vertexCount","undefined","attributes","name","needsRedraw","userData","Object","seal","setAttributes","setNeedsRedraw","redraw","getNeedsRedraw","clearRedrawFlags","setVertexCount","getVertexCount","indices","value","length","vertices","positions","hasAttribute","attributeName","Boolean","getAttribute","attribute","getArray","getAttributes","ArrayBuffer","isView","_print","_autoDetectAttribute","category","size","isIndexed","Uint16Array","Uint32Array"],"mappings":"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","sourcesContent":["import {uid} from '../utils';\nimport assert from '../utils/assert';\n\n// Rendering primitives - specify how to extract primitives from vertices.\n// NOTE: These are numerically identical to the corresponding WebGL/OpenGL constants\nexport const DRAW_MODE = {\n  POINTS: 0x0000, // draw single points.\n  LINES: 0x0001, // draw lines. Each vertex connects to the one after it.\n  LINE_LOOP: 0x0002, // draw lines. Each set of two vertices is treated as a separate line segment.\n  LINE_STRIP: 0x0003, // draw a connected group of line segments from the first vertex to the last\n  TRIANGLES: 0x0004, // draw triangles. Each set of three vertices creates a separate triangle.\n  TRIANGLE_STRIP: 0x0005, // draw a connected group of triangles.\n  TRIANGLE_FAN: 0x0006 // draw a connected group of triangles.\n  // Each vertex connects to the previous and the first vertex in the fan.\n};\n\n// Helper function to handle string draw modes - when using this library without WebGL constants\nexport function getDrawMode(drawMode) {\n  const mode = typeof drawMode === 'string' ? DRAW_MODE[drawMode] || DRAW_MODE.TRIANGLES : drawMode;\n  assert(mode >= 0 && mode <= DRAW_MODE.TRIANGLE_FAN, 'Illegal drawMode');\n  return mode;\n}\n\nexport default class Geometry {\n  constructor(opts = {}) {\n    const {id, drawMode = DRAW_MODE.TRIANGLES, vertexCount = undefined, attributes} = opts;\n\n    this.id = id || uid(this.constructor.name);\n    this.drawMode = getDrawMode(drawMode);\n    this.vertexCount = vertexCount;\n    this.attributes = {};\n    this.needsRedraw = true;\n    this.userData = {};\n    Object.seal(this);\n\n    if (attributes) {\n      this.setAttributes(attributes);\n    }\n  }\n\n  setNeedsRedraw(redraw = true) {\n    this.needsRedraw = redraw;\n    return this;\n  }\n\n  getNeedsRedraw({clearRedrawFlags = false} = {}) {\n    let redraw = false;\n    redraw = redraw || this.needsRedraw;\n    this.needsRedraw = this.needsRedraw && !clearRedrawFlags;\n    return redraw;\n  }\n\n  setVertexCount(vertexCount) {\n    this.vertexCount = vertexCount;\n  }\n\n  getVertexCount() {\n    if (this.vertexCount !== undefined) {\n      return this.vertexCount;\n    } else if (this.attributes.indices) {\n      return this.attributes.indices.value.length;\n    } else if (this.attributes.vertices) {\n      return this.attributes.vertices.value.length / 3;\n    } else if (this.attributes.positions) {\n      return this.attributes.positions.value.length / 3;\n    }\n    return false;\n  }\n\n  hasAttribute(attributeName) {\n    return Boolean(this.attributes[attributeName]);\n  }\n\n  getAttribute(attributeName) {\n    const attribute = this.attributes[attributeName];\n    assert(attribute);\n    return attribute.value;\n  }\n\n  getArray(attributeName) {\n    const attribute = this.attributes[attributeName];\n    assert(attribute);\n    return attribute.value;\n  }\n\n  getAttributes() {\n    return this.attributes;\n  }\n\n  // Attribute\n  // value: typed array\n  // type: indices, vertices, uvs\n  // size: elements per vertex\n  // target: WebGL buffer type (string or constant)\n  setAttributes(attributes) {\n    for (const attributeName in attributes) {\n      let attribute = attributes[attributeName];\n\n      // Wrap \"unwrapped\" arrays and try to autodetect their type\n      attribute = ArrayBuffer.isView(attribute) ? {value: attribute} : attribute;\n\n      assert(\n        ArrayBuffer.isView(attribute.value),\n        `${this._print(attributeName)}: must be typed array or object with value as typed array`\n      );\n\n      this._autoDetectAttribute(attributeName, attribute);\n\n      this.attributes[attributeName] = attribute;\n    }\n    this.setNeedsRedraw();\n    return this;\n  }\n\n  // Check for well known attribute names\n  /* eslint-disable default-case, complexity */\n  _autoDetectAttribute(attributeName, attribute) {\n    let category;\n    switch (attributeName) {\n      case 'indices':\n        category = category || 'indices';\n        break;\n      case 'texCoords':\n      case 'texCoord1':\n      case 'texCoord2':\n      case 'texCoord3':\n        category = 'uvs';\n        break;\n      case 'vertices':\n      case 'positions':\n      case 'normals':\n      case 'pickingColors':\n        category = 'vectors';\n        break;\n    }\n\n    // Check for categorys\n    switch (category) {\n      case 'vectors':\n        attribute.size = attribute.size || 3;\n        break;\n      case 'uvs':\n        attribute.size = attribute.size || 2;\n        break;\n      case 'indices':\n        attribute.size = attribute.size || 1;\n        attribute.isIndexed = attribute.isIndexed === undefined ? true : attribute.isIndexed;\n        assert(\n          attribute.value instanceof Uint16Array || attribute.value instanceof Uint32Array,\n          'attribute array for \"indices\" must be of integer type'\n        );\n        break;\n    }\n\n    assert(attribute.size, `attribute ${attributeName} needs size`);\n  }\n  /* eslint-enable default-case, complexity */\n\n  _print(attributeName) {\n    return `Geometry ${this.id} attribute ${attributeName}`;\n  }\n}\n"],"file":"geometry.js"}