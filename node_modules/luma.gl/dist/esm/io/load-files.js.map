{"version":3,"sources":["../../../src/io/load-files.js"],"names":["assert","loadFile","loadImage","Program","Texture2D","Model","Geometry","noop","loadTexture","gl","url","opts","then","image","Object","assign","id","data","loadFiles","urls","onProgress","every","count","Promise","all","map","promise","file","progress","length","total","loadImages","loadTextures","images","img","i","loadProgram","vs","fs","vsText","fsText","loadModel","parseModel","program","json","parseJSON","attributes","modelOptions","key","value","Array","isArray","Uint16Array","Float32Array","geometry","JSON","parse","error","Error"],"mappings":";;AAAA;AACA,OAAOA,MAAP,MAAmB,iBAAnB;AACA,SAAQC,QAAR,EAAkBC,SAAlB,QAAkC,gBAAlC;AACA,SAAQC,OAAR,EAAiBC,SAAjB,QAAiC,UAAjC;AACA,SAAQC,KAAR,QAAoB,SAApB;AACA,SAAQC,QAAR,QAAuB,aAAvB;;AAEA,SAASC,IAAT,GAAgB,CAAE;;AAElB,OAAO,SAASC,WAAT,CAAqBC,EAArB,EAAyBC,GAAzB,EAAyC;AAAA,MAAXC,IAAW,uEAAJ,EAAI;AAC9CX,EAAAA,MAAM,CAAC,OAAOU,GAAP,KAAe,QAAhB,EAA0B,iCAA1B,CAAN;AAEA,SAAOR,SAAS,CAACQ,GAAD,EAAMC,IAAN,CAAT,CAAqBC,IAArB,CAA0B,UAAAC,KAAK,EAAI;AACxC,WAAO,IAAIT,SAAJ,CAAcK,EAAd,EAAkBK,MAAM,CAACC,MAAP,CAAc;AAACC,MAAAA,EAAE,EAAEN;AAAL,KAAd,EAAyBC,IAAzB,EAA+B;AAACM,MAAAA,IAAI,EAAEJ;AAAP,KAA/B,CAAlB,CAAP;AACD,GAFM,CAAP;AAGD;AAED;;;;AAGA,OAAO,SAASK,SAAT,GAA8B;AAAA,MAAXP,IAAW,uEAAJ,EAAI;AAAA,MAC5BQ,IAD4B,GACDR,IADC,CAC5BQ,IAD4B;AAAA,yBACDR,IADC,CACtBS,UADsB;AAAA,MACtBA,UADsB,iCACTb,IADS;AAEnCP,EAAAA,MAAM,CAACmB,IAAI,CAACE,KAAL,CAAW,UAAAX,GAAG;AAAA,WAAI,OAAOA,GAAP,KAAe,QAAnB;AAAA,GAAd,CAAD,EAA6C,6CAA7C,CAAN;AACA,MAAIY,KAAK,GAAG,CAAZ;AACA,SAAOC,OAAO,CAACC,GAAR,CACLL,IAAI,CAACM,GAAL,CAAS,UAAAf,GAAG,EAAI;AACd,QAAMgB,OAAO,GAAGzB,QAAQ,CAACa,MAAM,CAACC,MAAP,CAAc;AAACL,MAAAA,GAAG,EAAHA;AAAD,KAAd,EAAqBC,IAArB,CAAD,CAAxB;AACAe,IAAAA,OAAO,CAACd,IAAR,CAAa,UAAAe,IAAI;AAAA,aACfP,UAAU,CAAC;AACTQ,QAAAA,QAAQ,EAAE,EAAEN,KAAF,GAAUH,IAAI,CAACU,MADhB;AAETP,QAAAA,KAAK,EAALA,KAFS;AAGTQ,QAAAA,KAAK,EAAEX,IAAI,CAACU,MAHH;AAITnB,QAAAA,GAAG,EAAHA;AAJS,OAAD,CADK;AAAA,KAAjB;AAQA,WAAOgB,OAAP;AACD,GAXD,CADK,CAAP;AAcD;AAED;;;;AAGA,OAAO,SAASK,UAAT,GAA+B;AAAA,MAAXpB,IAAW,uEAAJ,EAAI;AAAA,MAC7BQ,IAD6B,GACFR,IADE,CAC7BQ,IAD6B;AAAA,0BACFR,IADE,CACvBS,UADuB;AAAA,MACvBA,UADuB,kCACVb,IADU;AAEpCP,EAAAA,MAAM,CAACmB,IAAI,CAACE,KAAL,CAAW,UAAAX,GAAG;AAAA,WAAI,OAAOA,GAAP,KAAe,QAAnB;AAAA,GAAd,CAAD,EAA6C,6CAA7C,CAAN;AACA,MAAIY,KAAK,GAAG,CAAZ;AACA,SAAOC,OAAO,CAACC,GAAR,CACLL,IAAI,CAACM,GAAL,CAAS,UAAAf,GAAG,EAAI;AACd,QAAMgB,OAAO,GAAGxB,SAAS,CAACQ,GAAD,EAAMC,IAAN,CAAzB;AACAe,IAAAA,OAAO,CAACd,IAAR,CAAa,UAAAe,IAAI;AAAA,aACfP,UAAU,CAAC;AACTQ,QAAAA,QAAQ,EAAE,EAAEN,KAAF,GAAUH,IAAI,CAACU,MADhB;AAETP,QAAAA,KAAK,EAALA,KAFS;AAGTQ,QAAAA,KAAK,EAAEX,IAAI,CAACU,MAHH;AAITnB,QAAAA,GAAG,EAAHA;AAJS,OAAD,CADK;AAAA,KAAjB;AAQA,WAAOgB,OAAP;AACD,GAXD,CADK,CAAP;AAcD;AAED,OAAO,SAASM,YAAT,CAAsBvB,EAAtB,EAAqC;AAAA,MAAXE,IAAW,uEAAJ,EAAI;AAAA,MACnCQ,IADmC,GACRR,IADQ,CACnCQ,IADmC;AAAA,0BACRR,IADQ,CAC7BS,UAD6B;AAAA,MAC7BA,UAD6B,kCAChBb,IADgB;AAE1CP,EAAAA,MAAM,CACJmB,IAAI,CAACE,KAAL,CAAW,UAAAX,GAAG;AAAA,WAAI,OAAOA,GAAP,KAAe,QAAnB;AAAA,GAAd,CADI,EAEJ,+CAFI,CAAN;AAKA,SAAOqB,UAAU,CAACjB,MAAM,CAACC,MAAP,CAAc;AAACI,IAAAA,IAAI,EAAJA,IAAD;AAAOC,IAAAA,UAAU,EAAVA;AAAP,GAAd,EAAkCT,IAAlC,CAAD,CAAV,CAAoDC,IAApD,CAAyD,UAAAqB,MAAM;AAAA,WACpEA,MAAM,CAACR,GAAP,CAAW,UAACS,GAAD,EAAMC,CAAN,EAAY;AACrB,aAAO,IAAI/B,SAAJ,CAAcK,EAAd,EAAkBK,MAAM,CAACC,MAAP,CAAc;AAACC,QAAAA,EAAE,EAAEG,IAAI,CAACgB,CAAD;AAAT,OAAd,EAA6BxB,IAA7B,EAAmC;AAACM,QAAAA,IAAI,EAAEiB;AAAP,OAAnC,CAAlB,CAAP;AACD,KAFD,CADoE;AAAA,GAA/D,CAAP;AAKD;AAED,OAAO,SAASE,WAAT,CAAqB3B,EAArB,EAAoC;AAAA,MAAXE,IAAW,uEAAJ,EAAI;AAAA,MAClC0B,EADkC,GACL1B,IADK,CAClC0B,EADkC;AAAA,MAC9BC,EAD8B,GACL3B,IADK,CAC9B2B,EAD8B;AAAA,0BACL3B,IADK,CAC1BS,UAD0B;AAAA,MAC1BA,UAD0B,kCACbb,IADa;AAEzC,SAAOW,SAAS,CAACJ,MAAM,CAACC,MAAP,CAAc;AAACI,IAAAA,IAAI,EAAE,CAACkB,EAAD,EAAKC,EAAL,CAAP;AAAiBlB,IAAAA,UAAU,EAAVA;AAAjB,GAAd,EAA4CT,IAA5C,CAAD,CAAT,CAA6DC,IAA7D,CACL;AAAA;AAAA,QAAE2B,MAAF;AAAA,QAAUC,MAAV;;AAAA,WAAsB,IAAIrC,OAAJ,CAAYM,EAAZ,EAAgBK,MAAM,CAACC,MAAP,CAAc;AAACsB,MAAAA,EAAE,EAAEE,MAAL;AAAaD,MAAAA,EAAE,EAAEE;AAAjB,KAAd,EAAwC7B,IAAxC,CAAhB,CAAtB;AAAA,GADK,CAAP;AAGD,C,CAED;;AACA,OAAO,SAAS8B,SAAT,CAAmBhC,EAAnB,EAAkC;AAAA,MAAXE,IAAW,uEAAJ,EAAI;AAAA,MAChCD,GADgC,GACNC,IADM,CAChCD,GADgC;AAAA,0BACNC,IADM,CAC3BS,UAD2B;AAAA,MAC3BA,UAD2B,kCACdb,IADc;AAEvC,SAAOW,SAAS,CAACJ,MAAM,CAACC,MAAP,CAAc;AAACI,IAAAA,IAAI,EAAE,CAACT,GAAD,CAAP;AAAcU,IAAAA,UAAU,EAAVA;AAAd,GAAd,EAAyCT,IAAzC,CAAD,CAAT,CAA0DC,IAA1D,CAA+D;AAAA;AAAA,QAAEe,IAAF;;AAAA,WACpEe,UAAU,CAACjC,EAAD,EAAKK,MAAM,CAACC,MAAP,CAAc;AAACY,MAAAA,IAAI,EAAJA;AAAD,KAAd,EAAsBhB,IAAtB,CAAL,CAD0D;AAAA,GAA/D,CAAP;AAGD;AAED,OAAO,SAAS+B,UAAT,CAAoBjC,EAApB,EAAmC;AAAA,MAAXE,IAAW,uEAAJ,EAAI;AAAA,MACjCgB,IADiC,GACEhB,IADF,CACjCgB,IADiC;AAAA,sBACEhB,IADF,CAC3BgC,OAD2B;AAAA,MAC3BA,OAD2B,8BACjB,IAAIxC,OAAJ,CAAYM,EAAZ,CADiB;AAExC,MAAMmC,IAAI,GAAG,OAAOjB,IAAP,KAAgB,QAAhB,GAA2BkB,SAAS,CAAClB,IAAD,CAApC,GAA6CA,IAA1D,CAFwC,CAGxC;AACA;;AACA,MAAMmB,UAAU,GAAG,EAAnB;AACA,MAAMC,YAAY,GAAG,EAArB;;AACA,OAAK,IAAMC,GAAX,IAAkBJ,IAAlB,EAAwB;AACtB,QAAMK,KAAK,GAAGL,IAAI,CAACI,GAAD,CAAlB;;AACA,QAAIE,KAAK,CAACC,OAAN,CAAcF,KAAd,CAAJ,EAA0B;AACxBH,MAAAA,UAAU,CAACE,GAAD,CAAV,GAAkBA,GAAG,KAAK,SAAR,GAAoB,IAAII,WAAJ,CAAgBH,KAAhB,CAApB,GAA6C,IAAII,YAAJ,CAAiBJ,KAAjB,CAA/D;AACD,KAFD,MAEO;AACLF,MAAAA,YAAY,CAACC,GAAD,CAAZ,GAAoBC,KAApB;AACD;AACF;;AAED,SAAO,IAAI5C,KAAJ,CACLI,EADK,EAELK,MAAM,CAACC,MAAP,CAAc;AAAC4B,IAAAA,OAAO,EAAPA,OAAD;AAAUW,IAAAA,QAAQ,EAAE,IAAIhD,QAAJ,CAAa;AAACwC,MAAAA,UAAU,EAAVA;AAAD,KAAb;AAApB,GAAd,EAA+DC,YAA/D,EAA6EpC,IAA7E,CAFK,CAAP;AAID;;AAED,SAASkC,SAAT,CAAmBlB,IAAnB,EAAyB;AACvB,MAAI;AACF,WAAO4B,IAAI,CAACC,KAAL,CAAW7B,IAAX,CAAP;AACD,GAFD,CAEE,OAAO8B,KAAP,EAAc;AACd,UAAM,IAAIC,KAAJ,iCAAmCD,KAAnC,EAAN;AACD;AACF","sourcesContent":["/* eslint-disable guard-for-in, complexity, no-try-catch */\nimport assert from '../utils/assert';\nimport {loadFile, loadImage} from './browser-load';\nimport {Program, Texture2D} from '../webgl';\nimport {Model} from '../core';\nimport {Geometry} from '../geometry';\n\nfunction noop() {}\n\nexport function loadTexture(gl, url, opts = {}) {\n  assert(typeof url === 'string', 'loadTexture: url must be string');\n\n  return loadImage(url, opts).then(image => {\n    return new Texture2D(gl, Object.assign({id: url}, opts, {data: image}));\n  });\n}\n\n/*\n * Loads (Requests) multiple files asynchronously\n */\nexport function loadFiles(opts = {}) {\n  const {urls, onProgress = noop} = opts;\n  assert(urls.every(url => typeof url === 'string'), 'loadImages: {urls} must be array of strings');\n  let count = 0;\n  return Promise.all(\n    urls.map(url => {\n      const promise = loadFile(Object.assign({url}, opts));\n      promise.then(file =>\n        onProgress({\n          progress: ++count / urls.length,\n          count,\n          total: urls.length,\n          url\n        })\n      );\n      return promise;\n    })\n  );\n}\n\n/*\n * Loads (requests) multiple images asynchronously\n */\nexport function loadImages(opts = {}) {\n  const {urls, onProgress = noop} = opts;\n  assert(urls.every(url => typeof url === 'string'), 'loadImages: {urls} must be array of strings');\n  let count = 0;\n  return Promise.all(\n    urls.map(url => {\n      const promise = loadImage(url, opts);\n      promise.then(file =>\n        onProgress({\n          progress: ++count / urls.length,\n          count,\n          total: urls.length,\n          url\n        })\n      );\n      return promise;\n    })\n  );\n}\n\nexport function loadTextures(gl, opts = {}) {\n  const {urls, onProgress = noop} = opts;\n  assert(\n    urls.every(url => typeof url === 'string'),\n    'loadTextures: {urls} must be array of strings'\n  );\n\n  return loadImages(Object.assign({urls, onProgress}, opts)).then(images =>\n    images.map((img, i) => {\n      return new Texture2D(gl, Object.assign({id: urls[i]}, opts, {data: img}));\n    })\n  );\n}\n\nexport function loadProgram(gl, opts = {}) {\n  const {vs, fs, onProgress = noop} = opts;\n  return loadFiles(Object.assign({urls: [vs, fs], onProgress}, opts)).then(\n    ([vsText, fsText]) => new Program(gl, Object.assign({vs: vsText, fs: fsText}, opts))\n  );\n}\n\n// Loads a simple JSON format\nexport function loadModel(gl, opts = {}) {\n  const {url, onProgress = noop} = opts;\n  return loadFiles(Object.assign({urls: [url], onProgress}, opts)).then(([file]) =>\n    parseModel(gl, Object.assign({file}, opts))\n  );\n}\n\nexport function parseModel(gl, opts = {}) {\n  const {file, program = new Program(gl)} = opts;\n  const json = typeof file === 'string' ? parseJSON(file) : file;\n  // Remove any attributes so that we can create a geometry\n  // TODO - change format to put these in geometry sub object?\n  const attributes = {};\n  const modelOptions = {};\n  for (const key in json) {\n    const value = json[key];\n    if (Array.isArray(value)) {\n      attributes[key] = key === 'indices' ? new Uint16Array(value) : new Float32Array(value);\n    } else {\n      modelOptions[key] = value;\n    }\n  }\n\n  return new Model(\n    gl,\n    Object.assign({program, geometry: new Geometry({attributes})}, modelOptions, opts)\n  );\n}\n\nfunction parseJSON(file) {\n  try {\n    return JSON.parse(file);\n  } catch (error) {\n    throw new Error(`Failed to parse JSON: ${error}`);\n  }\n}\n"],"file":"load-files.js"}