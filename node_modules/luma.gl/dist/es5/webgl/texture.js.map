{"version":3,"sources":["../../../src/webgl/texture.js"],"names":["NPOT_MIN_FILTERS","TEXTURE_FORMATS","dataFormat","types","gl2","isFormatSupported","gl","format","info","gl1","undefined","value","getExtension","isLinearFilteringSupported","Texture","linearFiltering","supported","opts","id","handle","target","hasFloatTexture","textureUnit","width","height","data","pixels","type","border","recreate","parameters","pixelStore","unpackFlipY","mipmaps","_deduceParameters","compressed","Number","isFinite","activeTexture","bindTexture","DEFAULT_TEXTURE_SETTINGS","glSettings","Object","assign","_isNPOT","log","warn","_updateForNPOT","setImageData","generateMipmap","setParameters","initialize","params","level","offset","dataType","_getDataType","texImage2D","bindBuffer","compressedTexImage2D","x","y","ndarray","shape","Buffer","compressedTexSubImage2D","texSubImage2D","ArrayBuffer","isView","WebGLBuffer","framebuffer","internalFormat","bind","copyTexImage2D","unbind","getParameter","Error","internalformat","depth","texImage3D","textureFormat","_deduceImageSize","size","ImageData","HTMLImageElement","naturalWidth","naturalHeight","HTMLCanvasElement","HTMLVideoElement","videoWidth","videoHeight","createTexture","deleteTexture","pname","getTexParameter","param","_getNPOTParam","texParameterf","texParameteri","TEXTURE_MIN_FILTER","LINEAR","TEXTURE_WRAP_S","CLAMP_TO_EDGE","TEXTURE_WRAP_T","indexOf","Resource"],"mappings":"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","sourcesContent":["/* eslint-disable no-inline-comments, max-len */\nimport GL from '../constants';\n\nimport Resource from './resource';\nimport Buffer from './buffer';\n\nimport {withParameters} from '../webgl-context/context-state';\n\nimport {WebGLBuffer} from '../webgl-utils';\nimport {isWebGL2, assertWebGL2Context} from '../webgl-utils';\n\nimport {log, uid, isPowerOfTwo} from '../utils';\nimport assert from '../utils/assert';\n\n// Supported min filters for NPOT texture.\nconst NPOT_MIN_FILTERS = [GL.LINEAR, GL.NEAREST];\n\n// const S3TC = 'WEBGL_compressed_texture_s3tc';\n// const PVRTC = 'WEBGL_compressed_texture_pvrtc';\n// const ES3 = 'WEBGL_compressed_texture_es3';\n// const ETC1 = 'WEBGL_compressed_texture_etc1';\n// const SRGB = 'EXT_sRGB';\n// const DEPTH = 'WEBGL_depth_texture';\n\n// Legal combinations for internalFormat, format and type\nexport const TEXTURE_FORMATS = {\n  // Unsized texture format - more performance\n  [GL.RGB]: {dataFormat: GL.RGB, types: [GL.UNSIGNED_BYTE, GL.UNSIGNED_SHORT_5_6_5]},\n  // TODO: format: GL.RGBA type: GL.FLOAT is supported in WebGL1 when 'OES_texure_float' is suported\n  // we need to update this table structure to specify extensions (gl1: 'OES_texure_float', gl2: false) for each type.\n  [GL.RGBA]: {\n    dataFormat: GL.RGBA,\n    types: [GL.UNSIGNED_BYTE, GL.UNSIGNED_SHORT_4_4_4_4, GL.UNSIGNED_SHORT_5_5_5_1]\n  },\n  [GL.ALPHA]: {dataFormat: GL.ALPHA, types: [GL.UNSIGNED_BYTE]},\n  [GL.LUMINANCE]: {dataFormat: GL.LUMINANCE, types: [GL.UNSIGNED_BYTE]},\n  [GL.LUMINANCE_ALPHA]: {dataFormat: GL.LUMINANCE_ALPHA, types: [GL.UNSIGNED_BYTE]},\n\n  // 32 bit floats\n  [GL.R32F]: {dataFormat: GL.RED, types: [GL.FLOAT], gl2: true},\n  [GL.RG32F]: {dataFormat: GL.RG, types: [GL.FLOAT], gl2: true},\n  [GL.RGB32F]: {dataFormat: GL.RGB, types: [GL.FLOAT], gl2: true},\n  [GL.RGBA32F]: {dataFormat: GL.RGBA, types: [GL.FLOAT], gl2: true}\n\n  // [GL.DEPTH_COMPONENT]: {types: [GL.UNSIGNED_SHORT, GL.UNSIGNED_INT, GL.UNSIGNED_INT_24_8], gl1: DEPTH},\n  // [GL.DEPTH_STENCIL]: {gl1: DEPTH},\n\n  // Sized texture format - more performance\n  // R\n  // [GL.R8]: {dataFormat: GL.RED, types: [GL.UNSIGNED_BYTE], gl2: true},\n  // [GL.R16F]: {dataFormat: GL.RED, types: [GL.HALF_FLOAT, GL.FLOAT], gl2: true},\n  // [GL.R8UI]: {dataFormat: GL.RED_INTEGER, types: [GL.UNSIGNED_BYTE], gl2: true},\n  // // RG\n  // [GL.RG8]: {dataFormat: GL.RG, types: [GL.UNSIGNED_BYTE], gl2: true},\n  // [GL.RG16F]: {dataFormat: GL.RG, types: [GL.HALF_FLOAT, GL.FLOAT], gl2: true},\n  // [GL.RG8UI]: {dataFormat: GL.RG_INTEGER, types: [GL.UNSIGNED_BYTE], gl2: true},\n  // // RGB\n  // [GL.RGB8]: {dataFormat: GL.RGB, types: [GL.UNSIGNED_BYTE], gl2: true, gl1: SRGB},\n  // [GL.SRGB8]: {dataFormat: GL.RGB, types: [GL.UNSIGNED_BYTE], gl2: true, gl1: SRGB},\n  // [GL.RGB565]: {dataFormat: GL.RGB, types: [GL.UNSIGNED_BYTE, GL.UNSIGNED_SHORT_5_6_5], gl2: true},\n  // [GL.R11F_G11F_B10F]: {dataFormat: GL.RGB, types: [GL.UNSIGNED_INT_10F_11F_11F_REV, GL.HALF_FLOAT, GL.FLOAT], gl2: true},\n  // [GL.RGB9_E5]: {dataFormat: GL.RGB, types: [GL.HALF_FLOAT, GL.FLOAT], gl2: true, gl1: 'WEBGL_color_buffer_half_float'},\n  // [GL.RGB16F]: {dataFormat: GL.RGB, types: [GL.HALF_FLOAT, GL.FLOAT], gl2: true, gl1: 'WEBGL_color_buffer_float'},\n  // [GL.RGB8UI]: {dataFormat: GL.RGB_INTEGER, types: [GL.UNSIGNED_BYTE], gl2: true},\n  // // RGBA\n  // [GL.RGBA8]: {dataFormat: GL.RGBA, types: [GL.UNSIGNED_BYTE], gl2: true, gl1: SRGB},\n  // [GL.SRGB8_ALPHA8]: {dataFormat: GL.RGBA, types: [GL.UNSIGNED_BYTE], gl2: true, gl1: SRGB},\n  // [GL.RGB5_A1]: {dataFormat: GL.RGBA, types: [GL.UNSIGNED_BYTE, GL.UNSIGNED_SHORT_5_5_5_1], gl2: true},\n  // [GL.RGBA4]: {dataFormat: GL.RGBA, types: [GL.UNSIGNED_BYTE, GL.UNSIGNED_SHORT_4_4_4_4], gl2: true},\n  // [GL.RGBA16F]: {dataFormat: GL.RGBA, types: [GL.HALF_FLOAT, GL.FLOAT], gl2: true},\n  // [GL.RGBA8UI]: {dataFormat: GL.RGBA_INTEGER, types: [GL.UNSIGNED_BYTE], gl2: true}\n\n  // Compressed formats\n\n  // WEBGL_compressed_texture_s3tc\n\n  // [GL.COMPRESSED_RGB_S3TC_DXT1_EXT]: {compressed: true, gl1: S3TC},\n  // [GL.COMPRESSED_RGBA_S3TC_DXT1_EXT]: {compressed: true, gl1: S3TC},\n  // [GL.COMPRESSED_RGBA_S3TC_DXT3_EXT]: {compressed: true, gl1: S3TC},\n  // [GL.COMPRESSED_RGBA_S3TC_DXT5_EXT]: {compressed: true, gl1: S3TC},\n\n  // WEBGL_compressed_texture_es3\n\n  // [GL.COMPRESSED_R11_EAC]: {compressed: true, gl1: ES3}, // RED\n  // [GL.COMPRESSED_SIGNED_R11_EAC]: {compressed: true, gl1: ES3}, // RED\n  // [GL.COMPRESSED_RG11_EAC]: {compressed: true, gl1: ES3}, // RG\n  // [GL.COMPRESSED_SIGNED_RG11_EAC]: {compressed: true, gl1: ES3}, // RG\n  // [GL.COMPRESSED_RGB8_ETC2]: {compressed: true, gl1: ES3}, // RGB\n  // [GL.COMPRESSED_RGBA8_ETC2_EAC]: {compressed: true, gl1: ES3}, // RBG\n  // [GL.COMPRESSED_SRGB8_ETC2]: {compressed: true, gl1: ES3}, // RGB\n  // [GL.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC]: {compressed: true, gl1: ES3}, // RGBA\n  // [GL.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2]: {compressed: true, gl1: ES3}, // RGBA\n  // [GL.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2]: {compressed: true, gl1: ES3}, // RGBA\n  /* WebGL2 guaranteed availability compressed formats?\n  COMPRESSED_R11_EAC RED\n  COMPRESSED_SIGNED_R11_EAC RED\n  COMPRESSED_RG11_EAC RG\n  COMPRESSED_SIGNED_RG11_EAC RG\n  COMPRESSED_RGB8_ETC2 RGB\n  COMPRESSED_SRGB8_ETC2 RGB\n  COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2 RGBA\n  COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2 RGBA\n  COMPRESSED_RGBA8_ETC2_EAC RGBA\n  COMPRESSED_SRGB8_ALPHA8_ETC2_EAC\n  */\n\n  // WEBGL_compressed_texture_pvrtc\n\n  // [GL.COMPRESSED_RGB_PVRTC_4BPPV1_IMG]: {compressed: true, gl1: PVRTC},\n  // [GL.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG]: {compressed: true, gl1: PVRTC},\n  // [GL.COMPRESSED_RGB_PVRTC_2BPPV1_IMG]: {compressed: true, gl1: PVRTC},\n  // [GL.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG]: {compressed: true, gl1: PVRTC},\n\n  // WEBGL_compressed_texture_etc1\n\n  // [GL.COMPRESSED_RGB_ETC1_WEBGL]: {compressed: true, gl1: ETC1},\n\n  // WEBGL_compressed_texture_atc\n\n  // [GL.COMPRESSED_RGB_ATC_WEBGL]: {compressed: true, gl1: ETC1},\n  // [GL.COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL]: {compressed: true, gl1: ETC1},\n  // [GL.COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL]: {compressed: true, gl1: ETC1}\n};\n\nfunction isFormatSupported(gl, format) {\n  const info = TEXTURE_FORMATS[format];\n  if (!info) {\n    return false;\n  }\n  if (info.gl1 === undefined && info.gl2 === undefined) {\n    // No info - always supported\n    return true;\n  }\n  const value = isWebGL2(gl) ? info.gl2 || info.gl1 : info.gl1;\n  return typeof value === 'string' ? gl.getExtension(value) : value;\n}\n\nfunction isLinearFilteringSupported(gl, format) {\n  const info = TEXTURE_FORMATS[format];\n  switch (info && info.types[0]) {\n    // Both WebGL1 and WebGL2?\n    case GL.FLOAT:\n      return gl.getExtension('OES_texture_float_linear');\n    // Not in WebGL2?\n    case GL.HALF_FLOAT:\n      return gl.getExtension('OES_texture_half_float_linear');\n    default:\n      return true;\n  }\n}\n\nexport default class Texture extends Resource {\n  static isSupported(gl, {format, linearFiltering} = {}) {\n    let supported = true;\n    if (format) {\n      supported = supported && isFormatSupported(gl, format);\n      supported = supported && (!linearFiltering || isLinearFilteringSupported(gl, format));\n    }\n    return supported;\n  }\n\n  // target cannot be modified by bind:\n  // textures are special because when you first bind them to a target,\n  // they get special information. When you first bind a texture as a\n  // GL_TEXTURE_2D, you are actually setting special state in the texture.\n  // You are saying that this texture is a 2D texture.\n  // And it will always be a 2D texture; this state cannot be changed ever.\n  // If you have a texture that was first bound as a GL_TEXTURE_2D,\n  // you must always bind it as a GL_TEXTURE_2D;\n  // attempting to bind it as GL_TEXTURE_1D will give rise to an error\n  // (while run-time).\n  constructor(gl, opts) {\n    const {\n      id = uid('texture'),\n      handle,\n      target\n      // , magFilter, minFilter, wrapS, wrapT\n    } = opts;\n\n    super(gl, {id, handle});\n\n    this.target = target;\n    this.hasFloatTexture = gl.getExtension('OES_texture_float');\n    this.textureUnit = undefined;\n  }\n\n  toString() {\n    return `Texture(${this.id},${this.width}x${this.height})`;\n  }\n\n  /* eslint-disable max-len, max-statements */\n  initialize(opts = {}) {\n    let data = opts.data;\n\n    const {\n      pixels = null,\n      format = GL.RGBA,\n      type = GL.UNSIGNED_BYTE,\n      border = 0,\n      recreate = false,\n      parameters = {},\n      pixelStore = {},\n      textureUnit = undefined,\n      // Deprecated parameters\n      unpackFlipY = true\n    } = opts;\n\n    let {mipmaps = true} = opts;\n\n    // pixels variable is for API compatibility purpose\n    if (!data) {\n      // TODO - This looks backwards? Commenting out for now until we decide\n      // which prop to use\n      // log.deprecated('data', 'pixels')();\n      data = pixels;\n    }\n\n    let {width, height, dataFormat} = opts;\n\n    // Deduce width and height\n    ({width, height, dataFormat} = this._deduceParameters({\n      format,\n      type,\n      dataFormat,\n      compressed: false,\n      data,\n      width,\n      height\n    }));\n\n    // Store opts for accessors\n    this.width = width;\n    this.height = height;\n    this.format = format;\n    this.type = type;\n    this.dataFormat = dataFormat;\n    this.border = border;\n    this.textureUnit = textureUnit;\n\n    if (Number.isFinite(this.textureUnit)) {\n      this.gl.activeTexture(GL.TEXTURE0 + this.textureUnit);\n      this.gl.bindTexture(this.target, this.handle);\n    }\n\n    // Note: luma.gl defaults to GL.UNPACK_FLIP_Y_WEBGL = true;\n    // TODO - compare v4 and v3\n    const DEFAULT_TEXTURE_SETTINGS = {\n      // Pixel store\n      [GL.UNPACK_FLIP_Y_WEBGL]: unpackFlipY\n    };\n    const glSettings = Object.assign({}, DEFAULT_TEXTURE_SETTINGS, pixelStore);\n\n    if (this._isNPOT() && mipmaps) {\n      log.warn(`texture: ${this} is Non-Power-Of-Two, disabling mipmaping`)();\n      mipmaps = false;\n\n      this._updateForNPOT(parameters);\n    }\n    this.mipmaps = mipmaps;\n\n    this.setImageData({\n      data,\n      width,\n      height,\n      format,\n      type,\n      dataFormat,\n      border,\n      mipmaps,\n      parameters: glSettings\n    });\n\n    if (mipmaps) {\n      this.generateMipmap();\n    }\n\n    // Set texture sampler parameters\n    this.setParameters(parameters);\n\n    // TODO - Store data to enable auto recreate on context loss\n    if (recreate) {\n      this.data = data;\n    }\n  }\n\n  // If size has changed, reinitializes with current format\n  // note clears image and mipmaps\n  resize({width, height}) {\n    if (width !== this.width || height !== this.height) {\n      return this.initialize({\n        width,\n        height,\n        format: this.format,\n        type: this.type,\n        dataFormat: this.dataFormat,\n        border: this.border,\n        mipmaps: false\n      });\n    }\n    return this;\n  }\n\n  // Call to regenerate mipmaps after modifying texture(s)\n  generateMipmap(params = {}) {\n    this.gl.bindTexture(this.target, this.handle);\n    withParameters(this.gl, params, () => {\n      this.gl.generateMipmap(this.target);\n    });\n    this.gl.bindTexture(this.target, null);\n    return this;\n  }\n\n  /*\n   * Allocates storage\n   * @param {*} pixels -\n   *  null - create empty texture of specified format\n   *  Typed array - init from image data in typed array\n   *  Buffer|WebGLBuffer - (WEBGL2) init from image data in WebGLBuffer\n   *  HTMLImageElement|Image - Inits with content of image. Auto width/height\n   *  HTMLCanvasElement - Inits with contents of canvas. Auto width/height\n   *  HTMLVideoElement - Creates video texture. Auto width/height\n   *\n   * @param {GLint} width -\n   * @param {GLint} height -\n   * @param {GLint} mipMapLevel -\n   * @param {GLenum} format - format of image data.\n   * @param {GLenum} type\n   *  - format of array (autodetect from type) or\n   *  - (WEBGL2) format of buffer\n   * @param {Number} offset - (WEBGL2) offset from start of buffer\n   * @param {GLint} border - must be 0.\n   * @parameters - temporary settings to be applied, can be used to supply pixel store settings.\n   */\n  /* eslint-disable max-len, max-statements, complexity */\n  setImageData({\n    target = this.target,\n    pixels = null,\n    data = null,\n    width = this.width,\n    height = this.height,\n    level = 0,\n    format = this.format,\n    type = this.type,\n    dataFormat = this.dataFormat,\n    offset = 0,\n    border = this.border,\n    compressed = false,\n    parameters = {}\n  }) {\n    // pixels variable is  for API compatibility purpose\n    if (!data) {\n      data = pixels;\n    }\n\n    ({type, dataFormat, compressed, width, height} = this._deduceParameters({\n      format,\n      type,\n      dataFormat,\n      compressed,\n      data,\n      width,\n      height\n    }));\n\n    const {gl} = this;\n    gl.bindTexture(this.target, this.handle);\n\n    let dataType = null;\n    ({data, dataType} = this._getDataType({data, compressed}));\n\n    withParameters(this.gl, parameters, () => {\n      switch (dataType) {\n        case 'null':\n          gl.texImage2D(target, level, format, width, height, border, dataFormat, type, data);\n          break;\n        case 'typed-array':\n          // Looks like this assert is not necessary, as offset is ignored under WebGL1\n          // assert((offset === 0 || isWebGL2(gl)), 'offset supported in WebGL2 only');\n          gl.texImage2D(\n            target,\n            level,\n            format,\n            width,\n            height,\n            border,\n            dataFormat,\n            type,\n            data,\n            offset\n          );\n          break;\n        case 'buffer':\n          // WebGL2 enables creating textures directly from a WebGL buffer\n          assertWebGL2Context(gl);\n          gl.bindBuffer(GL.PIXEL_UNPACK_BUFFER, data.handle || data);\n          gl.texImage2D(target, level, format, width, height, border, dataFormat, type, offset);\n          gl.bindBuffer(GL.PIXEL_UNPACK_BUFFER, null);\n          break;\n        case 'browser-object':\n          if (isWebGL2(gl)) {\n            gl.texImage2D(target, level, format, width, height, border, dataFormat, type, data);\n          } else {\n            gl.texImage2D(target, level, format, dataFormat, type, data);\n          }\n          break;\n        case 'compressed':\n          gl.compressedTexImage2D(target, level, format, width, height, border, data);\n          break;\n        default:\n          assert(false, 'Unknown image data type');\n      }\n    });\n  }\n  /* eslint-enable max-len, max-statements, complexity */\n\n  /**\n   * Redefines an area of an existing texture\n   * Note: does not allocate storage\n   */\n  /*\n   * Redefines an area of an existing texture\n   * @param {*} pixels, data -\n   *  null - create empty texture of specified format\n   *  Typed array - init from image data in typed array\n   *  Buffer|WebGLBuffer - (WEBGL2) init from image data in WebGLBuffer\n   *  HTMLImageElement|Image - Inits with content of image. Auto width/height\n   *  HTMLCanvasElement - Inits with contents of canvas. Auto width/height\n   *  HTMLVideoElement - Creates video texture. Auto width/height\n   *\n   * @param {GLint} x - xOffset from where texture to be updated\n   * @param {GLint} y - yOffset from where texture to be updated\n   * @param {GLint} width - width of the sub image to be updated\n   * @param {GLint} height - height of the sub image to be updated\n   * @param {GLint} level - mip level to be updated\n   * @param {GLenum} format - internal format of image data.\n   * @param {GLenum} type\n   *  - format of array (autodetect from type) or\n   *  - (WEBGL2) format of buffer or ArrayBufferView\n   * @param {GLenum} dataFormat - format of image data.\n   * @param {Number} offset - (WEBGL2) offset from start of buffer\n   * @param {GLint} border - must be 0.\n   * @parameters - temporary settings to be applied, can be used to supply pixel store settings.\n   */\n  setSubImageData({\n    target = this.target,\n    pixels = null,\n    data = null,\n    x = 0,\n    y = 0,\n    width = this.width,\n    height = this.height,\n    level = 0,\n    format = this.format,\n    type = this.type,\n    dataFormat = this.dataFormat,\n    compressed = false,\n    offset = 0,\n    border = this.border,\n    parameters = {}\n  }) {\n    ({type, dataFormat, compressed, width, height} = this._deduceParameters({\n      format,\n      type,\n      dataFormat,\n      compressed,\n      data,\n      width,\n      height\n    }));\n\n    // pixels variable is  for API compatibility purpose\n    if (!data) {\n      data = pixels;\n    }\n\n    // Support ndarrays\n    if (data && data.data) {\n      const ndarray = data;\n      data = ndarray.data;\n      width = ndarray.shape[0];\n      height = ndarray.shape[1];\n    }\n\n    // Support buffers\n    if (data instanceof Buffer) {\n      data = data.handle;\n    }\n\n    this.gl.bindTexture(this.target, this.handle);\n\n    withParameters(this.gl, parameters, () => {\n      // TODO - x,y parameters\n      if (compressed) {\n        this.gl.compressedTexSubImage2D(target, level, x, y, width, height, format, data);\n      } else if (data === null) {\n        this.gl.texSubImage2D(target, level, x, y, width, height, dataFormat, type, null);\n      } else if (ArrayBuffer.isView(data)) {\n        this.gl.texSubImage2D(target, level, x, y, width, height, dataFormat, type, data, offset);\n      } else if (data instanceof WebGLBuffer) {\n        // WebGL2 allows us to create texture directly from a WebGL buffer\n        assertWebGL2Context(this.gl);\n        // This texImage2D signature uses currently bound GL.PIXEL_UNPACK_BUFFER\n        this.gl.bindBuffer(GL.PIXEL_UNPACK_BUFFER, data);\n        this.gl.texSubImage2D(target, level, x, y, width, height, dataFormat, type, offset);\n        this.gl.bindBuffer(GL.PIXEL_UNPACK_BUFFER, null);\n      } else if (isWebGL2(this.gl)) {\n        // Assume data is a browser supported object (ImageData, Canvas, ...)\n        this.gl.texSubImage2D(target, level, x, y, width, height, dataFormat, type, data);\n      } else {\n        this.gl.texSubImage2D(target, level, x, y, dataFormat, type, data);\n      }\n    });\n\n    this.gl.bindTexture(this.target, null);\n  }\n  /* eslint-enable max-len, max-statements, complexity */\n\n  /**\n   * Defines a two-dimensional texture image or cube-map texture image with\n   * pixels from the current framebuffer (rather than from client memory).\n   * (gl.copyTexImage2D wrapper)\n   *\n   * Note that binding a texture into a Framebuffer's color buffer and\n   * rendering can be faster.\n   */\n  copyFramebuffer({\n    target = this.target,\n    framebuffer,\n    x = 0,\n    y = 0,\n    width,\n    height,\n    level = 0,\n    internalFormat = GL.RGBA,\n    border = 0\n  }) {\n    if (framebuffer) {\n      framebuffer.bind();\n    }\n\n    // target\n    this.bind(0);\n    this.gl.copyTexImage2D(this.target, level, internalFormat, x, y, width, height, border);\n    this.unbind();\n\n    if (framebuffer) {\n      framebuffer.unbind();\n    }\n  }\n\n  getActiveUnit() {\n    return this.gl.getParameter(GL.ACTIVE_TEXTURE) - GL.TEXTURE0;\n  }\n\n  // target cannot be modified by bind:\n  // textures are special because when you first bind them to a target,\n  // they get special information. When you first bind a texture as a\n  // GL_TEXTURE_2D, you are actually setting special state in the texture.\n  // You are saying that this texture is a 2D texture.\n  // And it will always be a 2D texture; this state cannot be changed ever.\n  // If you have a texture that was first bound as a GL_TEXTURE_2D,\n  // you must always bind it as a GL_TEXTURE_2D;\n  // attempting to bind it as GL_TEXTURE_1D will give rise to an error\n  // (while run-time).\n\n  bind(textureUnit = this.textureUnit) {\n    if (textureUnit === undefined) {\n      throw new Error('Texture.bind: must specify texture unit');\n    }\n    this.textureUnit = textureUnit;\n    this.gl.activeTexture(GL.TEXTURE0 + textureUnit);\n    this.gl.bindTexture(this.target, this.handle);\n    return textureUnit;\n  }\n\n  unbind() {\n    if (this.textureUnit === undefined) {\n      throw new Error('Texture.unbind: texture unit not specified');\n    }\n    this.gl.activeTexture(GL.TEXTURE0 + this.textureUnit);\n    this.gl.bindTexture(this.target, null);\n    return this.textureUnit;\n  }\n\n  // PRIVATE METHODS\n\n  _getDataType({data, compressed = false}) {\n    if (compressed) {\n      return {data, dataType: 'compressed'};\n    }\n    if (data === null) {\n      return {data, dataType: 'null'};\n    }\n    if (ArrayBuffer.isView(data)) {\n      return {data, dataType: 'typed-array'};\n    }\n    if (data instanceof Buffer) {\n      return {data: data.handle, dataType: 'buffer'};\n    }\n    if (data instanceof WebGLBuffer) {\n      return {data, dataType: 'buffer'};\n    }\n    // Assume data is a browser supported object (ImageData, Canvas, ...)\n    return {data, dataType: 'browser-object'};\n  }\n\n  // Image 3D copies from Typed Array or WebGLBuffer\n  setImage3D({\n    level = 0,\n    internalformat = GL.RGBA,\n    width,\n    height,\n    depth = 1,\n    border = 0,\n    format,\n    type = GL.UNSIGNED_BYTE,\n    offset = 0,\n    pixels\n  }) {\n    if (ArrayBuffer.isView(pixels)) {\n      this.gl.texImage3D(\n        this.target,\n        level,\n        internalformat,\n        width,\n        height,\n        depth,\n        border,\n        format,\n        type,\n        pixels\n      );\n      return this;\n    }\n\n    if (pixels instanceof Buffer) {\n      this.gl.bindBuffer(GL.PIXEL_UNPACK_BUFFER, pixels.handle);\n      this.gl.texImage3D(\n        this.target,\n        level,\n        internalformat,\n        width,\n        height,\n        depth,\n        border,\n        format,\n        type,\n        offset\n      );\n    }\n\n    return this;\n  }\n\n  /* Copied from texture-2d.js\n  // WebGL2\n  setPixels(opts = {}) {\n    const {\n      buffer,\n      width = null,\n      height = null,\n      mipmapLevel = 0,\n      format = GL.RGBA,\n      type = GL.UNSIGNED_BYTE,\n      border = 0\n    } = opts;\n\n    const {gl} = this;\n\n    // This signature of texImage2D uses currently bound GL.PIXEL_UNPACK_BUFFER\n    gl.bindBuffer(GL.PIXEL_UNPACK_BUFFER, buffer.target);\n    // And as always, we must also bind the texture itself\n    this.bind();\n\n    gl.texImage2D(gl.TEXTURE_2D,\n      mipmapLevel, format, width, height, border, format, type, buffer.target);\n\n    this.unbind();\n    gl.bindBuffer(GL.GL.PIXEL_UNPACK_BUFFER, null);\n    return this;\n  }\n\n  setImageDataFromCompressedBuffer(opts) {\n    const {\n      buffer,\n      // offset = 0,\n      width = null,\n      height = null,\n      mipmapLevel = 0,\n      internalFormat = GL.RGBA,\n      // format = GL.RGBA,\n      // type = GL.UNSIGNED_BYTE,\n      border = 0\n    } = opts;\n\n    const {gl} = this;\n    gl.compressedTexImage2D(this.target,\n      mipmapLevel, internalFormat, width, height, border, buffer);\n    // gl.compressedTexSubImage2D(target,\n    //   level, xoffset, yoffset, width, height, format, ArrayBufferView? pixels);\n    return this;\n  }\n\n  copySubImage(opts) {\n    const {\n      // pixels,\n      // offset = 0,\n      // x,\n      // y,\n      // width,\n      // height,\n      // mipmapLevel = 0,\n      // internalFormat = GL.RGBA,\n      // type = GL.UNSIGNED_BYTE,\n      // border = 0\n    } = opts;\n\n    // if (pixels instanceof ArrayBufferView) {\n    //   gl.texSubImage2D(target, level, x, y, width, height, format, type, pixels);\n    // }\n    // gl.texSubImage2D(target, level, x, y, format, type, ? pixels);\n    // gl.texSubImage2D(target, level, x, y, format, type, HTMLImageElement pixels);\n    // gl.texSubImage2D(target, level, x, y, format, type, HTMLCanvasElement pixels);\n    // gl.texSubImage2D(target, level, x, y, format, type, HTMLVideoElement pixels);\n    // // Additional signature in a WebGL 2 context:\n    // gl.texSubImage2D(target, level, x, y, format, type, GLintptr offset);\n  }\n  */\n\n  // HELPER METHODS\n\n  _deduceParameters(opts) {\n    const {format, data} = opts;\n    let {width, height, dataFormat, type, compressed} = opts;\n\n    // Deduce format and type from format\n    const textureFormat = TEXTURE_FORMATS[format];\n    dataFormat = dataFormat || (textureFormat && textureFormat.dataFormat);\n    type = type || (textureFormat && textureFormat.types[0]);\n\n    // Deduce compression from format\n    compressed = compressed || (textureFormat && textureFormat.compressed);\n\n    ({width, height} = this._deduceImageSize(data, width, height));\n\n    return {dataFormat, type, compressed, width, height, format, data};\n  }\n\n  /* global ImageData, HTMLImageElement, HTMLCanvasElement, HTMLVideoElement */\n  // eslint-disable-next-line complexity\n  _deduceImageSize(data, width, height) {\n    let size;\n\n    if (typeof ImageData !== 'undefined' && data instanceof ImageData) {\n      size = {width: data.width, height: data.height};\n    } else if (typeof HTMLImageElement !== 'undefined' && data instanceof HTMLImageElement) {\n      size = {width: data.naturalWidth, height: data.naturalHeight};\n    } else if (typeof HTMLCanvasElement !== 'undefined' && data instanceof HTMLCanvasElement) {\n      size = {width: data.width, height: data.height};\n    } else if (typeof HTMLVideoElement !== 'undefined' && data instanceof HTMLVideoElement) {\n      size = {width: data.videoWidth, height: data.videoHeight};\n    } else if (!data) {\n      size = {width: width >= 0 ? width : 1, height: height >= 0 ? height : 1};\n    } else {\n      size = {width, height};\n    }\n\n    assert(size, 'Could not deduced texture size');\n    assert(\n      width === undefined || size.width === width,\n      'Deduced texture width does not match supplied width'\n    );\n    assert(\n      height === undefined || size.height === height,\n      'Deduced texture height does not match supplied height'\n    );\n\n    return size;\n  }\n\n  // RESOURCE METHODS\n\n  _createHandle() {\n    return this.gl.createTexture();\n  }\n\n  _deleteHandle() {\n    this.gl.deleteTexture(this.handle);\n  }\n\n  _getParameter(pname) {\n    switch (pname) {\n      case GL.TEXTURE_WIDTH:\n        return this.width;\n      case GL.TEXTURE_HEIGHT:\n        return this.height;\n      default:\n        this.gl.bindTexture(this.target, this.handle);\n        const value = this.gl.getTexParameter(this.target, pname);\n        this.gl.bindTexture(this.target, null);\n        return value;\n    }\n  }\n\n  _setParameter(pname, param) {\n    this.gl.bindTexture(this.target, this.handle);\n\n    // NOTE: Apply NPOT workaround\n    param = this._getNPOTParam(pname, param);\n\n    // Apparently there are some integer/float conversion rules that made\n    // the WebGL committe expose two parameter setting functions in JavaScript.\n    // For now, pick the float version for parameters specified as GLfloat.\n    switch (pname) {\n      case GL.TEXTURE_MIN_LOD:\n      case GL.TEXTURE_MAX_LOD:\n        this.gl.texParameterf(this.handle, pname, param);\n        break;\n\n      case GL.TEXTURE_WIDTH:\n      case GL.TEXTURE_HEIGHT:\n        assert(false);\n        break;\n\n      default:\n        this.gl.texParameteri(this.target, pname, param);\n        break;\n    }\n\n    this.gl.bindTexture(this.target, null);\n    return this;\n  }\n\n  _isNPOT() {\n    return !isWebGL2(this.gl) && (!isPowerOfTwo(this.width) || !isPowerOfTwo(this.height));\n  }\n\n  // Update default settings which are not supported by NPOT textures.\n  _updateForNPOT(parameters) {\n    if (parameters[this.gl.TEXTURE_MIN_FILTER] === undefined) {\n      // log.warn(`texture: ${this} is Non-Power-Of-Two, forcing TEXTURE_MIN_FILTER to LINEAR`)();\n      parameters[this.gl.TEXTURE_MIN_FILTER] = this.gl.LINEAR;\n    }\n    if (parameters[this.gl.TEXTURE_WRAP_S] === undefined) {\n      // log.warn(`texture: ${this} is Non-Power-Of-Two, forcing TEXTURE_WRAP_S to CLAMP_TO_EDGE`)();\n      parameters[this.gl.TEXTURE_WRAP_S] = this.gl.CLAMP_TO_EDGE;\n    }\n    if (parameters[this.gl.TEXTURE_WRAP_T] === undefined) {\n      // log.warn(`texture: ${this} is Non-Power-Of-Two, forcing TEXTURE_WRAP_T to CLAMP_TO_EDGE`)();\n      parameters[this.gl.TEXTURE_WRAP_T] = this.gl.CLAMP_TO_EDGE;\n    }\n  }\n\n  _getNPOTParam(pname, param) {\n    if (this._isNPOT()) {\n      switch (pname) {\n        case GL.TEXTURE_MIN_FILTER:\n          if (NPOT_MIN_FILTERS.indexOf(param) === -1) {\n            // log.warn(`texture: ${this} is Non-Power-Of-Two, forcing TEXTURE_MIN_FILTER to LINEAR`)();\n            param = GL.LINEAR;\n          }\n          break;\n        case GL.TEXTURE_WRAP_S:\n        case GL.TEXTURE_WRAP_T:\n          if (param !== GL.CLAMP_TO_EDGE) {\n            // log.warn(`texture: ${this} is Non-Power-Of-Two, ${getKey(this.gl, pname)} to CLAMP_TO_EDGE`)();\n            param = GL.CLAMP_TO_EDGE;\n          }\n          break;\n        default:\n          break;\n      }\n    }\n    return param;\n  }\n}\n"],"file":"texture.js"}